(this["webpackJsonpbeatroute-react"]=this["webpackJsonpbeatroute-react"]||[]).push([[0],{238:function(t,e){},331:function(t,e){},465:function(t,e,n){},469:function(t,e,n){},474:function(t,e,n){},475:function(t,e){},571:function(t,e){},572:function(t,e,n){},573:function(t,e){},574:function(t,e,n){},575:function(t,e,n){},577:function(t,e,n){},578:function(t,e,n){},579:function(t,e,n){},580:function(t,e,n){},581:function(t,e,n){},591:function(t,e,n){},592:function(t,e,n){},593:function(t,e,n){},594:function(t,e,n){"use strict";n.r(e);var i=n(9),r=n(2),o=n.n(r),a=n(80),s=n.n(a),c=n(37),d=n(20),l=n(293),u=(n(465),n(288)),h=n(446),f=n(633),p=n(295),v=n(632),j=n(47),b=n(49),g=n.n(b),m=n(328),O=n(447),x=n(46),y=(n(468),n(407)),P=n.n(y),_=(n(469),n(408));function w(){var t=Object(d.a)(["\n  mutation AddPhoto($objects: [media_insert_input!]!) {\n\n  insert_media(objects: $objects) {\n    returning {\n      id\n    }\n  }\n}\n\n"]);return w=function(){return t},t}var S=g()(w());var C=function(t){t.card;var e=t.refetch,n=function(t){var e=t.file,n=(t.meta,new FormData);return n.append("file",e),n.append("upload_preset","ml_default"),{url:"https://api.cloudinary.com/v1_1/db8uwhsbg/upload",body:n}};return Object(i.jsx)("div",{children:Object(i.jsx)(j.b,{onError:function(){return alert("Could not add photo")},onCompleted:function(){e&&e()},mutation:S,children:function(t,e){e.loading,e.error;return Object(i.jsx)("div",{className:"PhotoUpload",children:Object(i.jsx)(P.a,{getUploadParams:n,onChangeStatus:function(e,n){"done"===n&&_.a.gps(e.file).then((function(n){var i={type:"PHOTO",geo:n,data:Object(x.a)({},JSON.parse(e.xhr.response))};t({variables:{objects:[i]}}).then((function(){e.remove()}))}))},onSubmit:null,accept:"image/*",inputContent:function(t,e){return e.reject?"Image, audio and video files only":"Drag Files"}})})}})})},L=n(33),E=n(28),k=n(12),A=n(13),I=n(18),T=n(19),$=n(631),N=n(405),M=n(186),z=n(401),F=n(169),R=n(402),B=n(413),D=n.n(B),W=(n(474),n(188)),U=n(350),G=n(351),q=n(45),V=n(136),J=n(290),Y=n(109),K=n(31),Z=n(346),H=n(84);var X=function(t){Object(I.a)(n,t);var e=Object(T.a)(n);function n(t){return Object(k.a)(this,n),e.call(this,Object(x.a)(Object(x.a)({},t),{},{attributes:{positions:{size:3,padding:18,initialize:!0,type:t.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}}))}return Object(A.a)(n,[{key:"getGeometryFromBuffer",value:function(t){return this.normalize?Object(L.a)(Object(E.a)(n.prototype),"getGeometryFromBuffer",this).call(this,t):function(){return null}}},{key:"normalizeGeometry",value:function(t){return this.normalize?function(t,e,n,i){var r=t;if(Array.isArray(t[0])){var o=t.length*e;r=new Array(o);for(var a=0;a<t.length;a++)for(var s=0;s<e;s++)r[a*e+s]=t[a][s]||0}return n?Object(H.d)(r,{size:e,gridResolution:n}):i?Object(H.e)(r,{size:e}):r}(t,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):t}},{key:"get",value:function(t){return this.attributes[t]}},{key:"getGeometrySize",value:function(t){if(Array.isArray(t[0])){var e,n=0,i=Object(K.a)(t);try{for(i.s();!(e=i.n()).done;){var r=e.value;n+=this.getGeometrySize(r)}}catch(a){i.e(a)}finally{i.f()}return n}var o=this.getPathLength(t);return o<2?0:this.isClosed(t)?o<3?0:o+2:o}},{key:"updateGeometryAttributes",value:function(t,e){if(0!==e.geometrySize)if(t&&Array.isArray(t[0])){var n,i=Object(K.a)(t);try{for(i.s();!(n=i.n()).done;){var r=n.value,o=this.getGeometrySize(r);e.geometrySize=o,this.updateGeometryAttributes(r,e),e.vertexStart+=o}}catch(a){i.e(a)}finally{i.f()}}else this._updateSegmentTypes(t,e),this._updatePositions(t,e)}},{key:"_updateSegmentTypes",value:function(t,e){var n=this.attributes.segmentTypes,i=this.isClosed(t),r=e.vertexStart,o=e.geometrySize;n.fill(0,r,r+o),i?(n[r]=4,n[r+o-2]=4):(n[r]+=1,n[r+o-2]+=2),n[r+o-1]=4}},{key:"_updatePositions",value:function(t,e){var n=this.attributes.positions;if(n)for(var i=e.vertexStart,r=e.geometrySize,o=new Array(3),a=i,s=0;s<r;a++,s++)this.getPointOnPath(t,s,o),n[3*a]=o[0],n[3*a+1]=o[1],n[3*a+2]=o[2]}},{key:"getPathLength",value:function(t){return t.length/this.positionSize}},{key:"getPointOnPath",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=this.positionSize;e*i>=t.length&&(e+=1-t.length/i);var r=e*i;return n[0]=t[r],n[1]=t[r+1],n[2]=3===i&&t[r+2]||0,n}},{key:"isClosed",value:function(t){if(!this.normalize)return this.opts.loop;var e=this.positionSize,n=t.length-e;return t[0]===t[n]&&t[1]===t[n+1]&&(2===e||t[2]===t[n+2])}}]),n}(Z.a),Q="#define SHADER_NAME path-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute float instanceTypes;\nattribute vec3 instanceStartPositions;\nattribute vec3 instanceEndPositions;\nattribute vec3 instanceLeftPositions;\nattribute vec3 instanceRightPositions;\nattribute vec3 instanceLeftPositions64Low;\nattribute vec3 instanceStartPositions64Low;\nattribute vec3 instanceEndPositions64Low;\nattribute vec3 instanceRightPositions64Low;\nattribute float instanceStrokeWidths;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform float jointType;\nuniform float miterLimit;\nuniform bool billboard;\n\nuniform float opacity;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vPathPosition;\nvarying float vPathLength;\n\nconst float EPSILON = 0.001;\nconst vec3 ZERO_OFFSET = vec3(0.0);\n\nfloat flipIfTrue(bool flag) {\n  return -(float(flag) * 2. - 1.);\n}\n\n// calculate line join positions\nvec3 lineJoin(\n  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,\n  vec2 width\n) {\n  bool isEnd = positions.x > 0.0;\n  // side of the segment - -1: left, 0: center, 1: right\n  float sideOfPath = positions.y;\n  float isJoint = float(sideOfPath == 0.0);\n\n  vec3 deltaA3 = (currPoint - prevPoint);\n  vec3 deltaB3 = (nextPoint - currPoint);\n\n  mat3 rotationMatrix;\n  bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);\n  if (needsRotation) {\n    deltaA3 = deltaA3 * rotationMatrix;\n    deltaB3 = deltaB3 * rotationMatrix;\n  }\n  vec2 deltaA = deltaA3.xy / width;\n  vec2 deltaB = deltaB3.xy / width;\n\n  float lenA = length(deltaA);\n  float lenB = length(deltaB);\n\n  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);\n  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);\n\n  vec2 perpA = vec2(-dirA.y, dirA.x);\n  vec2 perpB = vec2(-dirB.y, dirB.x);\n\n  // tangent of the corner\n  vec2 tangent = dirA + dirB;\n  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;\n  // direction of the corner\n  vec2 miterVec = vec2(-tangent.y, tangent.x);\n  // direction of the segment\n  vec2 dir = isEnd ? dirA : dirB;\n  // direction of the extrusion\n  vec2 perp = isEnd ? perpA : perpB;\n  // length of the segment\n  float L = isEnd ? lenA : lenB;\n\n  // A = angle of the corner\n  float sinHalfA = abs(dot(miterVec, perp));\n  float cosHalfA = abs(dot(dirA, miterVec));\n\n  // -1: right, 1: left\n  float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);\n\n  // relative position to the corner:\n  // -1: inside (smaller side of the angle)\n  // 0: center\n  // 1: outside (bigger side of the angle)\n  float cornerPosition = sideOfPath * turnDirection;\n\n  float miterSize = 1.0 / max(sinHalfA, EPSILON);\n  // trim if inside corner extends further than the line segment\n  miterSize = mix(\n    min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),\n    miterSize,\n    step(0.0, cornerPosition)\n  );\n\n  vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))\n    * (sideOfPath + isJoint * turnDirection);\n\n  // special treatment for start cap and end cap\n  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));\n  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));\n  bool isCap = isStartCap || isEndCap;\n\n  // extend out a triangle to envelope the round cap\n  if (isCap) {\n    offsetVec = mix(perp * sideOfPath, dir * jointType * 4.0 * flipIfTrue(isStartCap), isJoint);\n  }\n\n  // Generate variables for fragment shader\n  vPathLength = L;\n  vCornerOffset = offsetVec;\n  vMiterLength = dot(vCornerOffset, miterVec * turnDirection);\n  vMiterLength = isCap ? isJoint : vMiterLength;\n\n  vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);\n  vPathPosition = vec2(\n    dot(offsetFromStartOfPath, perp),\n    dot(offsetFromStartOfPath, dir)\n  );\n  geometry.uv = vPathPosition;\n\n  float isValid = step(instanceTypes, 3.5);\n  vec3 offset = vec3(offsetVec * width * isValid, 0.0);\n  DECKGL_FILTER_SIZE(offset, geometry);\n\n  if (needsRotation) {\n    offset = rotationMatrix * offset;\n  }\n  return currPoint + offset;\n}\n\n// In clipspace extrusion, if a line extends behind the camera, clip it to avoid visual artifacts\nvoid clipLine(inout vec4 position, vec4 refPosition) {\n  if (position.w < EPSILON) {\n    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);\n    position = refPosition + (position - refPosition) * r;\n  }\n}\n\nvoid main() {\n  geometry.worldPosition = instanceStartPositions;\n  geometry.worldPositionAlt = instanceEndPositions;\n  geometry.pickingColor = instancePickingColors;\n\n  vec2 widthPixels = vec2(clamp(project_size_to_pixel(instanceStrokeWidths * widthScale),\n    widthMinPixels, widthMaxPixels) / 2.0);\n\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);\n\n  float isEnd = positions.x;\n\n  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);\n  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);\n\n  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);\n  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);\n\n  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);\n  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);\n\n  if (billboard) {\n    // Extrude in clipspace\n    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);\n    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);\n    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);\n\n    clipLine(prevPositionScreen, currPositionScreen);\n    clipLine(nextPositionScreen, currPositionScreen);\n    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));\n\n    vec2 width = project_pixel_size_to_clipspace(widthPixels);\n\n    vec3 pos = lineJoin(\n      prevPositionScreen.xyz / prevPositionScreen.w,\n      currPositionScreen.xyz / currPositionScreen.w,\n      nextPositionScreen.xyz / nextPositionScreen.w,\n      width\n    );\n\n    gl_Position = vec4(pos * currPositionScreen.w, currPositionScreen.w);\n  } else {\n    // Extrude in commonspace\n    prevPosition = project_position(prevPosition, prevPosition64Low);\n    currPosition = project_position(currPosition, currPosition64Low);\n    nextPosition = project_position(nextPosition, nextPosition64Low);\n\n    vec2 width = project_pixel_size(widthPixels);\n\n    vec4 pos = vec4(\n      lineJoin(prevPosition, currPosition, nextPosition, width),\n      1.0);\n    geometry.position = pos;\n    gl_Position = project_common_position_to_clipspace(pos);\n  }\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",tt="#define SHADER_NAME path-layer-fragment-shader\n\nprecision highp float;\n\nuniform float jointType;\nuniform float miterLimit;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\n/*\n * vPathPosition represents the relative coordinates of the current fragment on the path segment.\n * vPathPosition.x - position along the width of the path, between [-1, 1]. 0 is the center line.\n * vPathPosition.y - position along the length of the path, between [0, L / width].\n */\nvarying vec2 vPathPosition;\nvarying float vPathLength;\n\nvoid main(void) {\n  geometry.uv = vPathPosition;\n\n  if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {\n    // if joint is rounded, test distance from the corner\n    if (jointType > 0.0 && length(vCornerOffset) > 1.0) {\n      discard;\n    }\n    // trim miter\n    if (jointType == 0.0 && vMiterLength > miterLimit + 1.0) {\n      discard;\n    }\n  }\n  gl_FragColor = vColor;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",et=[0,0,0,255],nt={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},rounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:function(t){return t.path}},getColor:{type:"accessor",value:et},getWidth:{type:"accessor",value:1}},it={enter:function(t,e){return e.length?e.subarray(e.length-t.length):t}},rt=function(t){Object(I.a)(n,t);var e=Object(T.a)(n);function n(){return Object(k.a)(this,n),e.apply(this,arguments)}return Object(A.a)(n,[{key:"getShaders",value:function(){return Object(L.a)(Object(E.a)(n.prototype),"getShaders",this).call(this,{vs:Q,fs:tt,modules:[U.a,G.a]})}},{key:"initializeState",value:function(){var t=this;this.getAttributeManager().addInstanced({positions:{size:3,vertexOffset:1,type:V.default.DOUBLE,fp64:this.use64bitPositions(),transition:it,accessor:"getPath",update:this.calculatePositions,noAlloc:true,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:V.default.UNSIGNED_BYTE,update:this.calculateSegmentTypes,noAlloc:true},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:it,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:V.default.UNSIGNED_BYTE,normalized:!0,accessor:"getColor",transition:it,defaultValue:et},instancePickingColors:{size:3,type:V.default.UNSIGNED_BYTE,accessor:function(e,n){var i=n.index,r=n.target;return t.encodePickingColor(e&&e.__source?e.__source.index:i,r)}}}),this.setState({pathTesselator:new X({fp64:this.use64bitPositions()})}),this.props.getDashArray&&!this.props.extensions.length&&q.a.removed("getDashArray","PathStyleExtension")()}},{key:"updateState",value:function(t){var e=t.oldProps,i=t.props,r=t.changeFlags;Object(L.a)(Object(E.a)(n.prototype),"updateState",this).call(this,{props:i,oldProps:e,changeFlags:r});var o=this.getAttributeManager();if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPath)){var a=this.state.pathTesselator,s=i.data.attributes||{};a.updateGeometry({data:i.data,geometryBuffer:s.getPath,buffers:s,normalize:!i._pathType,loop:"loop"===i._pathType,getGeometry:i.getPath,positionFormat:i.positionFormat,wrapLongitude:i.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:r.dataChanged}),this.setState({numInstances:a.instanceCount,startIndices:a.vertexStarts}),r.dataChanged||o.invalidateAll()}if(r.extensionsChanged){var c=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(c)}),o.invalidateAll()}}},{key:"getPickingInfo",value:function(t){var e=Object(L.a)(Object(E.a)(n.prototype),"getPickingInfo",this).call(this,t),i=e.index,r=this.props.data;return r[0]&&r[0].__source&&(e.object=r.find((function(t){return t.__source.index===i}))),e}},{key:"draw",value:function(t){var e=t.uniforms,n=this.context.viewport,i=this.props,r=i.rounded,o=i.billboard,a=i.miterLimit,s=i.widthUnits,c=i.widthScale,d=i.widthMinPixels,l=i.widthMaxPixels,u="pixels"===s?n.metersPerPixel:1;this.state.model.setUniforms(Object.assign({},e,{jointType:Number(r),billboard:o,widthScale:c*u,miterLimit:a,widthMinPixels:d,widthMaxPixels:l})).draw()}},{key:"_getModel",value:function(t){return new J.a(t,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new Y.a({drawMode:V.default.TRIANGLES,attributes:{indices:new Uint16Array([0,1,2,1,4,2,1,3,4,3,5,4]),positions:{value:new Float32Array([0,0,0,-1,0,1,1,-1,1,1,1,0]),size:2}}}),isInstanced:!0}))}},{key:"calculatePositions",value:function(t){var e=this.state.pathTesselator;t.startIndices=e.vertexStarts,t.value=e.get("positions")}},{key:"calculateSegmentTypes",value:function(t){var e=this.state.pathTesselator;t.startIndices=e.vertexStarts,t.value=e.get("segmentTypes")}},{key:"wrapLongitude",get:function(){return!1}}]),n}(W.a);rt.layerName="PathLayer",rt.defaultProps=nt;var ot="DECKGL_FILTER_COLOR",at=Q.split(ot),st="\n\t\tattribute float instanceLengths;\n\t\tattribute float instanceNextLengths;\n\t\tvarying float vLength;\n\t\tuniform vec2 startingPoint;\n\t\tvarying vec2 vPosition;\n\t\tvarying float vWidth;\n\t"+at[0]+"\n\t\tvLength = instanceLengths + (instanceNextLengths - instanceLengths) * vPathPosition.y / vPathLength;\n\t\tvPosition = geometry.position.xy - project_position(startingPoint);\n\t\tvWidth = length(widthPixels);\n\t"+ot+at[1],ct=tt.split(ot),dt="\n\t\tvarying float vLength;\n\t\tvarying vec2 vPosition;\n\t\tvarying float vWidth;\n\n\t\tfloat pingpong (float x) {\n\t\t\treturn 1.0 - 2.0 * abs(mod(x, 2.0) - 1.0);\n\t\t}\n\t\tfloat noise (vec2 uv) {\n\t\t\tconst float k \t= 257.0;\n\t\t\tuv.xy = mod(uv.xy, 777.0);\n\t\t\tvec4 l  \t\t= vec4(floor(uv),fract(uv));\n\t\t\tl.zw    \t\t= l.zw*l.zw*(3.0-2.0*l.zw);\n\t\t\tfloat u \t\t= l.x + l.y * k;\n\t\t\tvec4 v  \t\t= vec4(u, u+1.0,u+k, u+k+1.0);\n\t\t\tv       \t\t= fract(fract(1.23456789*v)*v/.987654321);\n\t\t\tl.x     \t\t= mix(v.x, v.y, l.z);\n\t\t\tl.y     \t\t= mix(v.z, v.w, l.z);\n\t\t\treturn mix(l.x, l.y, l.w);\n\t\t}\n\t"+ct[0]+"\n\t\tfloat a = 0.0;\n\t\tfor (int i = 1; i < 4; i++) {\n\t\t\tfloat w = 0.33 - 0.01 * float(i);\n\t\t\tfloat s = pingpong( 1234.5 * vLength / (8.7 - float(i)) + float(i) );\n\t\t\tfloat d = abs( (1.0 - 2.0 * w) * s - vPathPosition.x );\n\t\t\ta = a + smoothstep(w, w - 0.2, d);\n\t\t}\n\t\tfloat zoomStrength = clamp( vWidth * 0.06, 0.0, 1.0 );\n\t\tgl_FragColor.a = mix( a, a * (\n\t\t\tnoise( vPosition * 3e4 + 1.2 * zoomStrength * vec2(noise( vPosition * 1e5 )) )\n\t\t\t\t * (0.5 + 0.5 * (1.0 - zoomStrength) + zoomStrength * noise( vPosition * 2e5 - 4. * vec2(noise( vPosition * 1e4 )) ) )\n\t\t), 0.66 );\n\t"+ot+ct[1],lt=function(t){Object(I.a)(n,t);var e=Object(T.a)(n);function n(t,i,r,o,a){var s;return Object(k.a)(this,n),t.getLengths=function(t){var e=0,n=s.props.getPath(t);return s.state.model.uniforms.startingPoint=n[0],n.map((function(t,n,i){return e+=n?Math.sqrt(Math.pow(t[0]-i[n-1][0],2)+Math.pow(t[1]-i[n-1][1],2)):0}))},s=e.call(this,t,i,r,o,a)}return Object(A.a)(n,[{key:"getShaders",value:function(){return W.a.prototype.getShaders.call(this,{vs:st,fs:dt,modules:[U.a,G.a]})}},{key:"initializeState",value:function(t){Object(L.a)(Object(E.a)(n.prototype),"initializeState",this).call(this,t),this.getAttributeManager().addInstanced({lengths:{size:1,accessor:"getLengths",shaderAttributes:{instanceLengths:{vertexOffset:0},instanceNextLengths:{vertexOffset:1}}}})}}]),n}(rt),ut=n(298),ht=n(326),ft=n(334),pt=ft.a.newSeed(),vt=new function t(){Object(k.a)(this,t),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.x=0,this.stageConfig={width:5e3,height:5e3},this.canvas.width=this.stageConfig.width,this.canvas.height=this.stageConfig.height,this.rc=ft.a.canvas(this.canvas);this.rc.ellipse(2500,2500,2500,2e3,{roughness:2.8,strokeWidth:100,stroke:"black",seed:pt})},jt=function(t){Object(I.a)(n,t);var e=Object(T.a)(n);function n(t){Object(k.a)(this,n);var i=ut.c(t.center),r=ut.b(i,1e3,{units:"meters"}),o=ut.a(r),a=Object(c.a)(o,4),s=a[0],d=a[1],l=a[2],u=a[3],h={id:"bitmap-layer4",bounds:[[s,d],[s,u],[l,u],[l,d]],image:vt.canvas,parameters:{depthTest:!1}};return e.call(this,h)}return n}(z.a);(function(t){Object(I.a)(n,t);var e=Object(T.a)(n);function n(){return Object(k.a)(this,n),e.apply(this,arguments)}return Object(A.a)(n,[{key:"initializeState",value:function(){}},{key:"shouldUpdateState",value:function(t){return t.changeFlags.somethingChanged}},{key:"finalizeState",value:function(){Object(L.a)(Object(E.a)(n.prototype),"finalizeState",this).call(this)}},{key:"renderLayers",value:function(){return[new jt({center:this.props.center})]}}]),n}(ht.a)).layerName="AnimatedLayer";var bt=n(282),gt=n(399),mt=function(t){Object(I.a)(n,t);var e=Object(T.a)(n);function n(){return Object(k.a)(this,n),e.apply(this,arguments)}return Object(A.a)(n,[{key:"initializeState",value:function(){this.setState({})}},{key:"shouldUpdateState",value:function(t){return t.changeFlags.somethingChanged}},{key:"finalizeState",value:function(){Object(L.a)(Object(E.a)(n.prototype),"finalizeState",this).call(this)}},{key:"renderLayers",value:function(){var t=this.props,e=t.scenegraph,n=t.asset;return[new gt.a({id:"scenegraph-layer"+n.id,data:[n.data],pickable:!0,scenegraph:e,getPosition:function(t){return t.position},getOrientation:function(t){return[0,t.angle,90]},getScale:function(t){return[t.scale,t.scale,t.scale]},sizeScale:4})]}}]),n}(ht.a);mt.componentName="AssetLayer";var Ot=n(95),xt=function(t){Object(I.a)(n,t);var e=Object(T.a)(n);function n(){return Object(k.a)(this,n),e.apply(this,arguments)}return Object(A.a)(n,[{key:"initializeState",value:function(){this.props.asset;console.log(Ot.feature([-2.8729248046875,54.54339315407258]))}},{key:"renderLayers",value:function(){var t=this,e=this.props.asset;return console.log(this.state.position),[new bt.EditableGeoJsonLayer({id:"mask-editor",data:this.state.position,opacity:1,mode:bt.TranslateMode,selectedFeatureIndexes:[0],_subLayerProps:{geojson:{getFillColor:function(){return[255,0,255,255]},getLineColor:function(){return[255,255,255,255]},pointRadiusMinPixels:50,pointRadiusMaxPixels:50}},onEdit:function(n){var i=n.updatedData,r=n.editType;t.setState({position:i}),"rotated"!==r&&"translated"!==r||alert(e.id)}})]}}]),n}(ht.a);xt.componentName="EditLayer";var yt=n(167),Pt=n(255),_t=n(226),wt=new yt.a({color:[255,255,255],direction:[1,1,-1],intensity:.8}),St=new yt.a({color:[255,255,255],direction:[1,1,-1],intensity:.8}),Ct=new Pt.a({color:[255,255,255],intensity:.4}),Lt=new _t.a({cl:wt,cl2:St,ambientLight:Ct}),Et={type:"FeatureCollection",features:[]},kt=function(t){Object(I.a)(n,t);var e=Object(T.a)(n);function n(t){var i;return Object(k.a)(this,n),(i=e.call(this,t)).state={editingAsset:null},i.debounce=D.a.debounce((function(t){return t()}),300),i}return Object(A.a)(n,[{key:"render",value:function(){var t=this,e=this.props.card.slides[this.props.slideIndex],n=[new F.a({id:"TileLayer",data:"https://tile.openstreetmap.org/{z}/{x}/{y}.png",tileSize:256,renderSubLayers:function(t){var e=t.tile.bbox,n=e.west,i=e.south,r=e.east,o=e.north;return new z.a(t,{data:null,desaturate:1,image:t.data,bounds:[n,i,r,o]})}}),new N.a({id:"route-layer",data:this.props.card.data||Et,lineWidthScale:1,lineWidthMinPixels:8,lineWidthMaxPixels:14,getLineColor:[255,238,100,255],getRadius:100,getLineWidth:10,_subLayerProps:{"line-strings":{type:lt}}}),e.assets.map((function(e){return new mt({onClick:function(){t.setState({editingAsset:e})},scenegraph:e.type,asset:e})})),this.state.editingAsset&&new xt({asset:this.state.editingAsset}),!1,new R.a({id:"text-layer",data:[1],pickable:!0,getPosition:function(t){return[-2.978496551513672,54.533135289883056]},getText:function(t){return"A fun day out"},getSize:40,sizeUnits:"meters",getAngle:32,billboard:!1,getTextAnchor:"middle",fontFamily:"DJB Sand Shoes and a Fez",getAlignmentBaseline:"center"})],r=this,o=function(t){Object(I.a)(n,t);var e=Object(T.a)(n);function n(t){return Object(k.a)(this,n),e.call(this,t)}return Object(A.a)(n,[{key:"handleEvent",value:function(t){var e=this;if(Object(L.a)(Object(E.a)(n.prototype),"handleEvent",this).call(this,t),"panend"===t.type||"wheel"===t.type){var i=r.props.card.slides[r.props.slideIndex];r.debounce((function(){return r.props.updateSlide({variables:{slide_id:i.id,data:Object(x.a)(Object(x.a)({},i.data),{},{pointB:r.props.slidePhotoRotation}),camera:e.controllerState._viewportProps}})}))}}}]),n}(M.b);return Object(i.jsx)("div",{children:Object(i.jsx)("div",{className:"Deck",children:Object(i.jsx)("div",{className:"poster",children:Object(i.jsx)($.a,{viewState:this.props.viewState,controller:{type:o,inertia:!0,touchRotate:!0,dragRotate:!0,scrollZoom:!0,doubleClickZoom:!1},_animate:!0,height:"100%",width:"100%",effects:[Lt],ref:function(e){t.deckGL=e},onViewStateChange:function(e){e.viewId;var n=e.viewState;t.props.setViewState(n)},layers:n})})})})}}]),n}(r.Component),At=(n(572),function(t){t.width,t.height;var e=t.children;return Object(i.jsx)("div",{className:"overlay",children:e})}),It=n(444),Tt=n(429);function $t(t){var e=t.card,n=t.updateTripGeojson,o=Object(r.useCallback)((function(t){if(t[0].name.endsWith(".gpx")){var i=new FileReader;i.onload=function(t){var i=t.target.result,r=(new DOMParser).parseFromString(i,"application/xml");n({variables:{id:e.id,geojson:Object(Tt.gpx)(r)}})},i.readAsText(t[0])}else alert("You must upload GPX files")}),[]),a=Object(It.a)({onDrop:o}),s=a.getRootProps,c=a.getInputProps,d=a.isDragActive;return Object(i.jsxs)("div",Object(x.a)(Object(x.a)({},s()),{},{children:[Object(i.jsx)("input",Object(x.a)({},c())),d?Object(i.jsx)("p",{children:"Drop here ..."}):Object(i.jsx)("button",{children:"Add GPS"})]}))}function Nt(){var t=Object(d.a)(["\n\nmutation MyMutation($id : Int, $geojson : jsonb) {\n\n  update_card(where: {id: {_eq: $id}}, _set: {data: $geojson}) {\n    returning {\n      id\n    }\n  }\n}\n"]);return Nt=function(){return t},t}var Mt=g()(Nt()),zt=function(t){t.trip;var e=t.children,n=t.refetch;return Object(i.jsx)(j.b,{onError:function(){return alert("Could not save trip")},mutation:Mt,onCompleted:function(){return n()},children:function(t,n){var o=n.loading,a=n.error;return Object(i.jsx)(r.Fragment,{children:e(t,o,a)})}})},Ft=(n(574),function(t){t.trip;return Object(i.jsx)("div",{className:"Front",children:Object(i.jsxs)(At,{width:450,height:600,children:[Object(i.jsx)("h1",{children:"Lake District 2021"}),Object(i.jsx)("img",{style:{width:"300px",height:"auto"},src:"/textures/title.png"})]})})});n(575),n(576);function Rt(){var t=Object(d.a)(["\n\nmutation( $card_id : Int,  $text : String){\n                update_cards(where: {id: {_eq: $card_id}}, _set: {text: $text}) {\n                    returning {\n                                id\n                              }\n                    }\n                }\n"]);return Rt=function(){return t},t}function Bt(){var t=Object(d.a)(["\n\nmutation( $card_id : Int,  $title : String){\n                update_cards(where: {id: {_eq: $card_id}}, _set: {title: $title}) {\n                    returning {\n                                id\n                              }\n                    }\n                }\n"]);return Bt=function(){return t},t}var Dt=g()(Bt()),Wt=(g()(Rt()),function(t){var e=t.card,n=(t.i,Object(r.useState)(170)),o=Object(c.a)(n,2),a=o[0];o[1];return Object(i.jsx)("div",{className:"Title",children:Object(i.jsx)(At,{width:350,height:a,children:Object(i.jsx)(j.b,{onError:function(){return alert("Could not save title")},mutation:Dt,children:function(t,n){n.loading,n.error;return Object(i.jsx)("h1",{onBlur:function(n){return t({variables:{title:n.currentTarget.textContent,card_id:e.id}})},contentEditable:!0,suppressContentEditableWarning:!0,children:e.title})}})})})});function Ut(){var t=Object(d.a)(["\n\nmutation( $card_id : Int,  $landscapecamera : jsonb){\n                update_cards(where: {id: {_eq: $card_id}}, _set: {landscapecamera: $landscapecamera}) {\n                    returning {\n                                camera\n                                id\n                              }\n                    }\n                }\n"]);return Ut=function(){return t},t}function Gt(){var t=Object(d.a)(["\n\nmutation( $card_id : Int,  $annotations : jsonb){\n                update_cards(where: {id: {_eq: $card_id}}, _set: {annotations: $annotations}) {\n                    returning {\n                                camera\n                                id\n                              }\n                    }\n                }\n"]);return Gt=function(){return t},t}function qt(){var t=Object(d.a)(["\n\nmutation( $card_id : Int,  $map : jsonb){\n                update_cards(where: {id: {_eq: $card_id}}, _set: {map: $map}) {\n                    returning {\n                                camera\n                                id\n                              }\n                    }\n                }\n"]);return qt=function(){return t},t}function Vt(){var t=Object(d.a)(["\n\nmutation( $slidemedia_id : Int,  $json : jsonb){\n                update_slide_media(where: {id: {_eq: $slidemedia_id}}, _set: {json: $json}) {\n                    returning {\n                                id\n                              }\n                    }\n                }\n"]);return Vt=function(){return t},t}function Jt(){var t=Object(d.a)(["\n\nmutation( $slide_id : Int,  $camera : jsonb, $data : jsonb){\n                update_card_slide(where: {id: {_eq: $slide_id}}, _set: {data : $data, camera : $camera}) {\n                    returning {\n                                data\n                                camera\n                                id\n                              }\n                    }\n                }\n"]);return Jt=function(){return t},t}function Yt(){var t=Object(d.a)(["\n\nmutation( $card_id : Int,  $camera : jsonb){\n                update_cards(where: {id: {_eq: $card_id}}, _set: {camera: $camera}) {\n                    returning {\n                                camera\n                                id\n                              }\n                    }\n                }\n"]);return Yt=function(){return t},t}var Kt=g()(Yt()),Zt=g()(Jt()),Ht=g()(Vt()),Xt=g()(qt()),Qt=g()(Gt()),te=g()(Ut()),ee=function(t){var e=t.refetch,n=t.children;return Object(i.jsx)("div",{children:Object(i.jsx)(j.b,{onError:function(){return alert("Could not save slide media")},onCompleted:function(){return e()},mutation:Ht,children:function(t,o){o.loading,o.error;return Object(i.jsx)(j.b,{onError:function(){return alert("Could not save slide")},mutation:Zt,children:function(o,a){a.loading,a.error;return Object(i.jsx)(j.b,{onError:function(){return alert("Could not save map")},mutation:Xt,children:function(a,s){s.loading,s.error;return Object(i.jsx)(j.b,{onError:function(){return alert("Could not save camera")},mutation:Kt,children:function(s,c){c.loading,c.error;return Object(i.jsx)(r.Fragment,{children:Object(i.jsx)(j.b,{onError:function(){return alert("Could not save camera")},mutation:Qt,onCompleted:function(){return e()},children:function(c,d){d.loading,d.error;return Object(i.jsx)(r.Fragment,{children:Object(i.jsx)(j.b,{onError:function(){return alert("Could not save landscaape")},mutation:te,onCompleted:function(){return e()},children:function(e,d){var l=d.loading,u=d.error;return Object(i.jsx)(r.Fragment,{children:n(o,s,a,c,e,t,l,u)})}})})}})})}})}})}})}})})},ne=n(64),ie=n(445),re=n(128),oe=(n(577),{elevation:{apiKey:"1b045ec93f5b94db894037db8d297128e"},imagery:{urlFormat:"https://api.maptiler.com/tiles/satellite/{z}/{x}/{y}.jpg?key=cZQg2QaktSnI18BSAxZX",attribution:'<a href="https://www.maptiler.com/copyright/">Maptiler</a> <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}}),ae=function(t){Object(I.a)(n,t);var e=Object(T.a)(n);function n(t){var i;Object(k.a)(this,n),(i=e.call(this,t)).myRef=o.a.createRef();Object(ne.a)(i);return window.setTimeout((function(){re.a.orbitTarget()}),3e3),i}return Object(A.a)(n,[{key:"render",value:function(){return Object(i.jsx)("div",{className:"Map",children:Object(i.jsx)(ie.a,{ref:this.myRef,datasource:oe,compassVisible:!1,displayLocation:this.props.location})})}}]),n}(o.a.Component);n(578);function se(){var t=Object(d.a)(["\n\nmutation( $card_id : Int,  $data : jsonb){\n                update_card(where: {id: {_eq: $card_id}}, _set: {data: $data}) {\n                    returning {\n                                id\n                              }\n                    }\n                }\n"]);return se=function(){return t},t}var ce=g()(se()),de=function(t){var e=t.card;t.i;return Object(i.jsx)("div",{className:"blue paper",children:Object(i.jsx)(j.b,{onError:function(){return alert("Could not save title")},mutation:ce,children:function(t,n){n.loading,n.error;return Object(i.jsx)("h1",{onBlur:function(n){return t({variables:{data:Object(x.a)(Object(x.a)({},e.data),{},{text:n.currentTarget.textContent}),card_id:e.id}})},contentEditable:!0,suppressContentEditableWarning:!0,children:e.data.text||"Enter Text"})}})})},le=(n(579),n(53)),ue=n.n(le),he=n(448),fe=n(101);function pe(){var t=Object(d.a)(["\n    display: flex;\n    flex-direction: row;\n    width: 100%;\n    align-items: center;\n    justify-content: center;\n    padding: 6px 8px;\n    cursor: pointer;\n"]);return pe=function(){return t},t}var ve=n(431).a.div(pe());n(580);function je(){var t=Object(d.a)(["\n    mutation MyMutation($card_id : Int, $data : jsonb) {\n    \n      insert_card_slide(objects: {card_id: $card_id, data : $data}) {\n        returning {\n          id\n        }\n      }\n    }\n"]);return je=function(){return t},t}var be=g()(je()),ge=function(t){var e=t.card,n=t.refetch,o=t.slideIndex,a=t.setSlideIndex;return Object(i.jsx)("div",{children:Object(i.jsx)(j.b,{onError:function(){return alert("Could not add slide")},onCompleted:function(){n(),a(o+1)},variables:{data:{text:"Write here"}},mutation:be,children:function(t,n){n.loading,n.error;return Object(i.jsx)(r.Fragment,{children:Object(i.jsx)("button",{onClick:function(){t({variables:{card_id:e.id}})},children:"New slide"})})}})})},me=n(184);function Oe(){var t=Object(d.a)(["\n\nmutation UpdateSlide($slide_id : Int, $data : jsonb) {\n  update_card_slide(where: {id: {_eq: $slide_id }}, _set: {data: $data}) {\n    returning {\n      id\n    }\n  }\n}\n"]);return Oe=function(){return t},t}g()(Oe());function xe(){var t=Object(d.a)(["\n\nmutation UpdateSlide($slide_id : Int, $data : jsonb) {\n  update_card_slide(where: {id: {_eq: $slide_id }}, _set: {data: $data}) {\n    returning {\n      id\n    }\n  }\n}\n"]);return xe=function(){return t},t}g()(xe()),n(581);function ye(){var t=Object(d.a)(["\n\nmutation MyMutation($slide_id : Int, $data : jsonb) {\n  update_card_slide(where: {id: {_eq: $slide_id}}, _set: {data: $data}) {\n    returning {\n      id\n    }\n  }\n}\n\n"]);return ye=function(){return t},t}var Pe=g()(ye()),_e=function(t){var e=t.slide,n=t.media,r=t.refetch,o=t.closeModal,a=t.pointB;return Object(i.jsx)("div",{children:Object(i.jsx)(j.b,{onError:function(){return alert("Could not add title card")},onCompleted:function(){return o()&&r&&r()},mutation:Pe,variables:{slide_id:e.id,data:Object(x.a)(Object(x.a)({},e.data),{},{pointB:a,photo:n.json.url})},children:function(t,e){e.loading,e.error;return Object(i.jsx)("wired-button",{elevation:"2",onClick:t,children:"Set photo"})}})})};function we(){var t=Object(d.a)(["\n               {\n               \n                media {\n                  id\n                  json\n                  location\n                }\n  \n              }\n"]);return we=function(){return t},t}var Se=g()(we()),Ce=function(t){var e=t.slide,n=t.closeModal,o=t.pointB;return Object(i.jsx)("div",{children:Object(i.jsx)(j.c,{query:Se,children:function(t){var a=t.loading,s=(t.error,t.data);t.refetch;return a||!s?null:Object(i.jsx)(r.Fragment,{children:Object(i.jsx)("ul",{children:s.media.map((function(t){return Object(i.jsxs)("li",{children:[Object(i.jsx)("img",{style:{height:"140px",width:"auto"},src:t.json.url}),Object(i.jsx)(_e,{media:t,slide:e,closeModal:n,pointB:o})]})}))})})}})})},Le=(n(595),n(435)),Ee=n.n(Le),ke=function(t){var e=t.slide,n=t.viewState,o=Object(r.useState)(!1),a=Object(c.a)(o,2),s=a[0],d=a[1];function l(){d(!1)}var u=new me.a(n),h=u.unproject([u.width/2,u.width/2],{topLeft:!0}),f={scale:1,rotation:1,position:Ot.featureCollection([Ot.point(h)])};return Object(i.jsxs)(r.Fragment,{children:[Object(i.jsx)("button",{onClick:function(){d(!0)},children:"Open Modal"}),Object(i.jsxs)(Ee.a,{isOpen:s,onRequestClose:l,style:{content:{top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)"}},children:[Object(i.jsx)("button",{onClick:l,children:"close"}),Object(i.jsx)(Ce,{slide:e,closeModal:l,pointB:f})]})]})};function Ae(){var t=Object(d.a)(["\n\nmutation MyMutation($slide_id : Int) {\n  delete_card_slide(where: {id: {_eq: $slide_id}}) {\n     returning {\n      id\n    }\n  }\n\n}\n\n"]);return Ae=function(){return t},t}var Ie=g()(Ae()),Te=function(t){t.viewState;var e=t.slide;t.refetch;return Object(i.jsx)("div",{children:Object(i.jsx)(j.b,{onError:function(){return alert("Could not add slide photo")},onCompleted:function(){return window.location.reload()},mutation:Ie,variables:{slide_id:e.id},children:function(t,e){e.loading,e.error;return Object(i.jsx)("button",{onClick:function(){return t()},children:"Delete"})}})})},$e=n(623),Ne=n(638),Me=n(624),ze=function(t){var e=t.setLocked,n=t.slidePhotoRotation,r=t.setSlidePhotoRotation,o=Object(i.jsxs)("div",{children:[Object(i.jsx)($e.a,{min:-90,max:90,defaultValue:0,onChange:function(t){return r(Object(x.a)(Object(x.a)({},n),{},{rotation:t}))}}),Object(i.jsx)($e.a,{min:0,max:500,defaultValue:10,onChange:function(t){return r(Object(x.a)(Object(x.a)({},n),{},{scale:t}))}})]});return Object(i.jsx)("div",{children:Object(i.jsx)(Ne.a,{content:o,title:"Title",trigger:"click",children:Object(i.jsx)(Me.a,{onClick:function(){return e(!0)},children:"Click me"})})})},Fe=n(62);function Re(){var t=Object(d.a)(["\n\nmutation( $slide_id : Int,  $data : jsonb){\n                update_card_slide(where: {id: {_eq: $slide_id}}, _set: {data: $data}) {\n                    returning {\n                                id\n                              }\n                    }\n                }\n"]);return Re=function(){return t},t}var Be=g()(Re()),De=function(t){var e=t.edit,n=t.slide,r=t.refetch,o=t.slideIndex,a=t.setSlideIndex;return Object(i.jsx)(j.b,{onError:function(){return alert("Could not save title")},onCompleted:function(){r(),a(o+1)},mutation:Be,children:function(t,r){var o,a;r.loading,r.error;return Object(i.jsx)("div",(a={contentEditable:e,suppressContentEditableWarning:!0,onBlur:function(e){return t({variables:{data:Object(x.a)(Object(x.a)({},n.data),{},{text:e.currentTarget.textContent}),slide_id:n.id}})}},Object(Fe.a)(a,"contentEditable",!0),Object(Fe.a)(a,"suppressContentEditableWarning",!0),Object(Fe.a)(a,"children",null===(o=n.data)||void 0===o?void 0:o.text),a))}})};function We(){var t=Object(d.a)(["\n\n mutation MyMutation($slide_id : Int, $data : jsonb, $type : String) {\n  insert_asset_one(object: {data: $data, slide_id: $slide_id, type : $type}, on_conflict: {constraint: asset_pkey, update_columns: data}) {\n    id\n  }\n}\n"]);return We=function(){return t},t}var Ue=g()(We()),Ge=function(t){return Object(i.jsx)(j.b,{mutation:Ue,onCompleted:function(){return t.refetch()},variables:{slide_id:t.slide.id,data:{scale:100,position:[-2.96,54.531],angle:50},type:t.type},children:function(t,e){var n=e.loading,r=e.error;e.data;return n?Object(i.jsx)("pre",{children:"Loading"}):r?Object(i.jsxs)("pre",{children:["Error in MY_MUTATION_MUTATION",JSON.stringify(r,null,2)]}):Object(i.jsx)("div",{children:Object(i.jsx)("button",{onClick:function(){return t()},children:"Add"})})}})},qe=function(t){var e,n=t.setLocked,o=t.card,a=t.slide,s=t.refetch,d=t.slideIndex,l=t.setSlideIndex,u=t.viewState,h=t.slidePhotoRotation,f=t.setSlidePhotoRotation,p=Object(r.useState)(!1),v=Object(c.a)(p,2),j=v[0],b=v[1];return Object(i.jsxs)("div",{className:"slide",children:[!j&&(null===(e=a.data)||void 0===e?void 0:e.text),j&&Object(i.jsx)(De,{slideIndex:d,edit:j,slide:a,refetch:s,setSlideIndex:l}),Object(i.jsx)(Te,{slide:a,refetch:s}),Object(i.jsx)(Ge,{slide:a,refetch:s,viewState:u,type:"/textures/arrow2.glb"}),Object(i.jsx)("br",{}),Object(i.jsx)(ze,{setLocked:n,slidePhotoRotation:h,setSlidePhotoRotation:f,slide:a,refetch:s}),Object(i.jsx)("button",{onClick:function(){return b(!0)},children:"Edit"}),d+1===o.slides.length&&Object(i.jsx)(ge,{card:o,refetch:s,slideIndex:d,setSlideIndex:l}),Object(i.jsx)(zt,{refetch:s,children:function(t,e){e.loading,e.error;return Object(i.jsx)($t,{card:o,updateTripGeojson:t})}}),u&&Object(i.jsx)(ke,{slide:a,refetch:s,viewState:u}),Object(i.jsx)("br",{})]})};n(591);function Ve(t){var e=t.slidePhotoRotation,n=t.setSlidePhotoRotation,o=t.setCurrentPhoto,a=t.viewState,s=t.setViewState,d=t.setSlideIndex,l=t.slideIndex,u=t.card,h=t.refetch,f=t.className,p=t.style,v=function(t){var e=Object(r.useRef)();return Object(r.useEffect)((function(){e.current=t})),e.current}({slides:u.slides.length}),j=Object(r.useState)(!1),b=Object(c.a)(j,2),g=(b[0],b[1]),m=Object(he.a)({withLoop:!1,items:u.slides.map((function(t,r){return{id:r,renderItem:Object(i.jsx)(qe,{setLocked:g,slidePhotoRotation:e,setSlidePhotoRotation:n,viewState:a,card:u,slide:t,refetch:h,slideIndex:l,setSlideIndex:d})}}))}),O=m.carouselFragment,y=(m.getCurrentActiveItem,m.useListenToCustomEvent),P=m.slideToNextItem;return Object(r.useEffect)((function(){v&&u.slides.length>v.slides&&P()}),[u.slides.length]),y("onSlideStartChange",(function(t){d(t.nextItem),o(u.slides[t.nextItem].data.geojson),u.slides[t.nextItem].camera&&s(Object(x.a)({transitionDuration:750,transitionInterpolator:new fe.a},u.slides[t.nextItem].camera))})),Object(i.jsx)("div",{className:ue()("carousel",f),style:p,children:Object(i.jsx)("div",{className:"carousel-wrapper",children:Object(i.jsx)("div",{style:{flex:1},children:O})})})}Ve.ItemActions=ve;var Je=Ve;l.a.registerPlugin(u.a);var Ye=function(t){Object(I.a)(n,t);var e=Object(T.a)(n);function n(t){var i,r,o,a;return Object(k.a)(this,n),(a=e.call(this,t)).state={canvas:null,slideIndex:0,slidePhotoRotation:null,viewState:t.card.slides[0].camera?null===(i=t.card.slides[0])||void 0===i?void 0:i.camera:{longitude:0,latitude:50,zoom:4},currentPhoto:null===(r=t.card.slides[0])||void 0===r||null===(o=r.data)||void 0===o?void 0:o.geojson},a}return Object(A.a)(n,[{key:"componentDidUpdate",value:function(t,e,n){this.state.slideIndex;e.slideIndex}},{key:"render",value:function(){var t=this,e=this.state,n=e.currentPhoto,r=e.slideIndex,o=e.viewState,a=e.slidePhotoRotation,s=(e.canvas,this.props.client),c=function(e){return t.setState({currentPhoto:e})},d=function(e){return t.setState({slideIndex:e})},l=function(e){return t.setState({viewState:e})},u=function(e){return t.setState({slidePhotoRotation:e})},h=this.props;return Object(i.jsx)("div",{className:"sketch-card",children:Object(i.jsxs)("div",{children:[Object(i.jsx)(de,{card:h.card}),Object(i.jsx)(ae,{location:{animationDuration:10,longitude:7.698941573782926,latitude:45.74338484004915,height:2183.358398660126,angle:36.11883143607126,bearing:70.35532994923864}}),Object(i.jsx)(ee,{refetch:h.refetch,children:function(t,e,f,p,v,j,b,g){return Object(i.jsxs)("div",{children:[Object(i.jsx)(kt,{slidePhotoRotation:a,setSlidePhotoRotation:u,client:s,setCurrentPhoto:c,currentPhoto:n,slideIndex:r,refetch:h.refetch,viewState:o,setViewState:l,width:h.width,updateSlide:t,updateSlideMedia:j,updateMap:e,updateAnnotation:p,trip:h.trip,card:h.card}),Object(i.jsx)(Je,{slidePhotoRotation:a,setSlidePhotoRotation:u,setCurrentPhoto:c,slideIndex:r,setSlideIndex:d,viewState:o,setViewState:l,refetch:h.refetch,card:h.card})]})}})]})})}}]),n}(r.Component);n(592);var Ke=function(t){return Object(i.jsxs)("div",{className:"mask-mode-frame",style:{transform:void 0!==t.rotateDeg?"rotate(".concat(t.rotateDeg,"deg)"):void 0},children:[Object(i.jsx)("div",{className:"mask-mode-frame-img",children:Object(i.jsx)("div",{children:Object(i.jsx)("img",{src:t.imgSource,alt:""})})}),t.ActionComponent&&Object(i.jsx)("div",{className:"mask-mode-frame-footer",children:Object(i.jsx)(t.ActionComponent,{})})]})},Ze=function(t){return t%2===0?4*(Math.random()-1.5):8*Math.random()};n(593);function He(t){var e=t.card;t.refetch;return Object(i.jsx)("div",{children:Object(i.jsx)("div",{className:"mask-mode-container",children:e.assets.map((function(t,e){return Object(i.jsx)(Ke,{imgSource:t.data?t.data.info.url:"",rotateDeg:Ze(e),ActionComponent:function(){return Object(i.jsx)("div",{className:"Add",children:Object(i.jsx)("div",{contentEditable:!0,suppressContentEditableWarning:!0,children:"TEST"})})}},e)}))})})}function Xe(){var t=Object(d.a)(['\n\nmutation MyMutation($trip_id : Int) {\n  insert_cards(objects: {trip_id: $trip_id, type: "Front"}) {\n    returning {\n      id\n    }\n  }\n}\n']);return Xe=function(){return t},t}var Qe=g()(Xe()),tn=function(t){var e=t.trip,n=t.refetch;return Object(i.jsx)("div",{children:Object(i.jsx)(j.b,{onError:function(){return alert("Could not add front card")},onCompleted:function(){return n()},mutation:Qe,variables:{trip_id:e.id},children:function(t,e){e.loading,e.error;return Object(i.jsx)("wired-button",{elevation:"2",onClick:t,children:"Add Front"})}})})};function en(){var t=Object(d.a)(['\n\nmutation MyMutation($trip_id : Int) {\n  insert_cards(objects: {trip_id: $trip_id, type: "Title"}) {\n    returning {\n      id\n    }\n  }\n}\n']);return en=function(){return t},t}var nn=g()(en()),rn=function(t){var e=t.trip,n=t.refetch;return Object(i.jsx)("div",{children:Object(i.jsx)(j.b,{onError:function(){return alert("Could not add title card")},onCompleted:function(){return n()},mutation:nn,variables:{trip_id:e.id},children:function(t,e){e.loading,e.error;return Object(i.jsx)("wired-button",{elevation:"2",onClick:t,children:"Add Title"})}})})};function on(){var t=Object(d.a)(['\n\nmutation MyMutation($content : jsonb, $trip_id : Int) {\n  insert_cards(objects: {trip_id: $trip_id, type: "PhotosOnMap", content : $content}) {\n    returning {\n      id\n    }\n  }\n}\n']);return on=function(){return t},t}var an=g()(on()),sn={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Polygon",coordinates:[[[0,0],[4,0],[4,4],[0,4],[0,0]]]},properties:{type:"map"}},{type:"Feature",geometry:{type:"Point",coordinates:[-1.845703125,2.0210651187669897]},properties:{type:"photo"}}]},cn=function(t){var e=t.trip,n=t.refetch;return Object(i.jsx)("div",{children:Object(i.jsx)(j.b,{onError:function(){return alert("Could not add title card")},onCompleted:function(){return n()},mutation:an,variables:{content:sn,trip_id:e.id},children:function(t,e){e.loading,e.error;return Object(i.jsx)("wired-button",{elevation:"2",onClick:t,children:"Add Photos On Map"})}})})};function dn(){var t=Object(d.a)(['\n\nmutation ($content : jsonb, $camera : jsonb, $trip_id : Int, $slide_data : jsonb) {\n\n  insert_card(objects: [\n                {trip_id: $trip_id, type: "Sketch", data : $content, slides : {data : [{data : $slide_data, camera : $camera}]}},\n              \n                ]) {\n    returning {\n      id\n    }\n  }\n}\n\n\n\n']);return dn=function(){return t},t}var ln=g()(dn()),un={zoom:3.0129167754311057,pitch:0,bearing:0,maxZoom:20,minZoom:0,altitude:1.5,latitude:8.256043799900645,maxBearing:0,minBearing:0,longitude:2.6226391365730866},hn={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Polygon",coordinates:[[[0,0],[4,0],[4,4],[0,4],[0,0]]]},properties:{type:"map"}},{type:"Feature",geometry:{type:"Point",coordinates:[-1.845703125,2.0210651187669897]},properties:{type:"photo"}}]},fn=function(t){var e=t.trip,n=t.refetch;return Object(i.jsx)("div",{children:Object(i.jsx)(j.b,{onError:function(){return alert("Could not add sketch card")},onCompleted:function(){return n()},mutation:ln,variables:{camera:un,content:hn,slide_data:{text:"Write here"},trip_id:e.id},children:function(t,n){n.loading,n.error;return Object(i.jsxs)("wired-button",{elevation:"2",onClick:t,children:["Add Sketch and photos ",e.name]})}})})},pn=function(t){var e=t.trip,n=t.refetch,o=Object(r.useState)(!1),a=Object(c.a)(o,2),s=a[0],d=a[1];return Object(i.jsxs)(r.Fragment,{children:[Object(i.jsx)("wired-button",{elevation:"2",onClick:function(){d(!0)},children:"Add Content"}),s&&Object(i.jsxs)("div",{children:[Object(i.jsx)(tn,{trip:e,refetch:n}),Object(i.jsx)("br",{}),Object(i.jsx)(rn,{trip:e,refetch:n}),Object(i.jsx)("br",{}),Object(i.jsx)(cn,{trip:e,refetch:n}),Object(i.jsx)("br",{}),Object(i.jsx)(fn,{trip:e,refetch:n})]})]})},vn=n(337),jn=n.n(vn),bn={display:["INLINE_STYLE_BUTTONS","BLOCK_TYPE_BUTTONS","LINK_BUTTONS","BLOCK_TYPE_DROPDOWN","HISTORY_BUTTONS"],INLINE_STYLE_BUTTONS:[{label:"Bold",style:"BOLD",className:"custom-css-class"}],BLOCK_TYPE_DROPDOWN:[{label:"Normal",style:"unstyled"},{label:"Heading Large",style:"header-one"}],BLOCK_TYPE_BUTTONS:[{label:"UL",style:"unordered-list-item"}]};r.Component;function gn(){var t=Object(d.a)(['\n               {\n               \n                media {\n                  id\n                }\n  \n                owners:owner(where: {id: {_eq: "cyclefriendly"}}) {\n                  id\n                  \n                  trips(where: {url: {_eq: "lakes2021"}}) {\n                    id\n                    name\n                    url\n                    \n                    cards(order_by: {id: asc}) {\n                      id\n                      type\n                      data\n                      \n                      slides(order_by: {id: asc}) {\n                          camera\n                          data\n                          id\n                          assets {\n                                  id\n                                  data\n                                  type\n                          }\n                      }\n                      \n                    }\n                  }\n                }\n              }\n\n']);return gn=function(){return t},t}var mn=g()(gn());l.a.registerPlugin(u.a);var On=new f.a({uri:"https://guided-viper-73.hasura.app/v1/graphql"}),xn=new p.a({link:On,cache:new v.a}),yn=function(){var t=o.a.useMemo((function(){return m.b()}),[]),e=Object(r.useState)(0),n=Object(c.a)(e,2),a=n[0],s=n[1],d=!0;return Object(i.jsx)("div",{className:"App",children:Object(i.jsx)(j.a,{client:xn,children:Object(i.jsx)(j.c,{query:mn,children:function(e){var n=e.loading,o=(e.error,e.data),c=e.refetch;if(n||!o)return null;var l=o.owners[0].trips[0],u=o.owners[0].trips[0].cards,f=a<u.length;return l.cards.forEach((function(t){Object(O.a)(t.data,(function(t){t.length>2&&t.pop()}))})),Object(i.jsx)(r.Fragment,{children:Object(i.jsx)(h.a,{bounds:!0,children:function(e){var n=e.measureRef,r=e.contentRect.bounds.width;return Object(i.jsxs)("div",{children:[Object(i.jsx)("h1",{children:l.name}),Object(i.jsxs)("h2",{children:[" ",Object(i.jsx)(C,{refetch:c})," "]}),Object(i.jsxs)("main",{className:"App-main",children:[Object(i.jsx)(m.a,{node:t,children:Object(i.jsx)("div",{children:" this is one time component"})}),u.map((function(e,n){return"Front"===e.type?Object(i.jsxs)("div",{className:"App-section",children:[Object(i.jsx)("code",{children:e.id}),Object(i.jsx)(Ft,{trip:l,card:e,index:n},n+""+e.id)]},n):"Title"===e.type?Object(i.jsxs)("div",{className:"App-section",children:[Object(i.jsx)("code",{children:e.id}),Object(i.jsx)(Wt,{card:e,i:n},n+""+e.id)]},n):"Sketch"===e.type?Object(i.jsxs)("div",{className:"App-section",children:[Object(i.jsx)("code",{children:JSON.stringify(e.id)}),Object(i.jsx)(Ye,{client:xn,trip:l,portalNode2:t,width:r<500?r:500,admin:d,stillLoading:f,incrementLoadedCount:function(){return s(a+1)},index:n,card:e,refetch:c},n+""+e.id)]},n):"Polaroid"===e.type?Object(i.jsxs)("div",{className:"App-section",children:[Object(i.jsx)("code",{children:e.id}),Object(i.jsx)(He,{width:r<500?r:500,admin:d,stillLoading:f,incrementLoadedCount:function(){return s(a+1)},index:n,card:e,refetch:c},n+""+e.id)]},n):null})),Object(i.jsx)("div",{className:"xApp-section",style:{height:"100%"},children:Object(i.jsx)(pn,{trip:l,refetch:c})}),Object(i.jsxs)("div",{ref:n,children:["My width is ",r]})]})]})}})})}})})})},Pn=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function _n(t,e){navigator.serviceWorker.register(t).then((function(t){t.onupdatefound=function(){var n=t.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),e&&e.onUpdate&&e.onUpdate(t)):(console.log("Content is cached for offline use."),e&&e.onSuccess&&e.onSuccess(t)))})}})).catch((function(t){console.error("Error during service worker registration:",t)}))}var wn=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,639)).then((function(e){var n=e.getCLS,i=e.getFID,r=e.getFCP,o=e.getLCP,a=e.getTTFB;n(t),i(t),r(t),o(t),a(t)}))};document.fonts.ready.then((function(){s.a.render(Object(i.jsx)(yn,{}),document.getElementById("root"))})),function(t){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("","/service-worker.js");Pn?(!function(t,e){fetch(t,{headers:{"Service-Worker":"script"}}).then((function(n){var i=n.headers.get("content-type");404===n.status||null!=i&&-1===i.indexOf("javascript")?navigator.serviceWorker.ready.then((function(t){t.unregister().then((function(){window.location.reload()}))})):_n(t,e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e,t),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):_n(e,t)}))}}(),wn()}},[[594,1,2]]]);
//# sourceMappingURL=main.6fd3b651.chunk.js.map